<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Komu W - Logging without losing context or your money.</title>
    <meta name="description" content="Logging without losing context or your money." />
    <meta property="og:url" content="https://www.komu.engineer/blog" />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ADD FAVICON -->

    <link rel="stylesheet" href="../../site.css">

    <!-- Get highlightjs by going to https://highlightjs.org/download/, select the languages you want and download. -->
    <link rel="stylesheet" href="../../highlightjs/styles/default.css">
    <script src="../../highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
    <div class="container">
        <div class="header">
            <a href="https://www.komu.engineer">Home</a>&nbsp;&nbsp;
            <a href="https://www.komu.engineer/about">About Me</a>&nbsp;&nbsp;
            <a href="https://www.komu.engineer/blog">Blog</a>&nbsp;&nbsp;
        </div>
        <div class="left-sidebar">
            .
        </div>
        <div class="right-sidebar">
            .
        </div>

        <div class="main">
            <p>
                </br>
                <strong>Logging without losing context or your money. (25 May 2020)</strong>
                </br></br>

                In your application, you want all flows of execution to be covered with log statements. That way, if something were to go wrong you can be able to trace at which point the flow broke at.</br>
                However, this presents a problem; if your application has lots of traffic, then the amount of logs it generates are going to be gigantic. This in itself is not a problem, were it not 
                for the fact that you are using a logging as a service provider and <a target="_blank" rel="noopener" href="https://www.datadoghq.com/pricing/">they</a> all
                 <a target="_blank" rel="noopener" href="https://www.loggly.com/plans-and-pricing/">charge</a> an <a target="_blank" rel="noopener" href="https://www.honeycomb.io/pricing/">arm</a> and
                  a <a target="_blank" rel="noopener" href="https://www.sumologic.com/pricing/">leg</a> for every log event.</br>
                Some of the pricing models are so inscrutable, that the logging providers offer calculators <a target="_blank" rel="noopener" href="https://calculator.aws/">[1]</a> 
                <a target="_blank" rel="noopener" href="https://cloud.google.com/products/calculator">[2]</a> to try and help you out figure out what should ideally have been kindergaten arithmetic.</br></br>

                So it seems like for you to have your cake and eat it too, you have to part with large sums of money every month(and due to elastic pricing you can't even tell in advance how much that will be.)</br>
                There are two main ways that people try and solve this problem(usually at the <a target="_blank" rel="noopener" href="https://docs.datadoghq.com/logs/indexes/#switch-off-switch-on">suggestion</a> of the <a target="_blank" rel="noopener" href="https://docs.honeycomb.io/working-with-your-data/best-practices/sampling/">said</a> logging providers);</br>
                <ol>
                    <li>Filtering logs by severity and only sending logs above a certain severity to the logging provider.</li>
                    <li>Sampling logs so that you only send a certain percentage to the logging provider.</li>
                </ol>
                But these two solutions pose a problem; loss of context.</br>
                Consider an application that updates multiple social media platforms with a status message.
                <pre><code class="go">
func main() {
    updateSocialMedia("Sending out my first social media status message")
}

func updateSocialMedia(msg string) {
	traceID := "sa225Hqk" //should be randomly generated per call
	logger := logrus.WithFields(logrus.Fields{"traceID": traceID})

	tweet(msg, logger)
	facebook(msg, logger)
	linkedin(msg, logger)
}

func tweet(msg string, logger *logrus.Entry) {
	logger.Info("tweet send start")
	// code to call twitter API goes here
	logger.Info("tweet send end.")
}

func facebook(msg string, logger *logrus.Entry) {
	logger.Info("facebook send start")
	err := facebookAPI(msg)
	if err != nil {
		logger.Errorf("facebook send failed. error=%s", err)
	}
	logger.Info("facebook send end.")
}

func linkedin(msg string, logger *logrus.Entry) {
	logger.Info("linkedin send start")
	// code to call linkedin API goes here
	logger.Info("linkedin send end.")
}
                </code></pre>

                If we were filtering logs and only sending logs of ERROR level to our logging provider, then we would lose context on how the <i>facebook send failed</i> error came to be. I had previosuly written 
                that logs are primarily used to <a target="_blank" rel="noopener" href="https://www.komu.engineer/blogs/timescaledb/timescaledb-for-logs#Opinion">help debug issues in production;</a> thus, 
                context and chronology of events that led to a particular issue are of importance. You do not want to investigate a murder mystery where half the clues have been deliberately wiped out by your earlier self.</br>
                In the same way, if we were sampling logs; the chronology leading upto the error would be missing a few INFO log statements since they would have been sampled out.</br></br>

                What we want is;</br>
                If there are no errors, no logs gets sent to our logging provider(INFO or otherwise.) However, if there are any errors; all the logs leading to that error irrespective of their severity/level are sent to the logging service.
                
                

            </p>
        </div>
    </div>
</body>